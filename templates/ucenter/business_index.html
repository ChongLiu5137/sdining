{% load staticfiles %}
{% load mvctags %}
<!doctype html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta id="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1, minimum-scale=1,  user-scalable=no,minimal-ui"
          name="viewport">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" type="text/css" href="{% static 'css/ucenter/business.css' %}">
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <title>商家个人中心</title>
    <style>
        .aactive {
            background-color: rgb(230, 230, 230);
            color: rgba(193, 54, 68, 0.92) !important;
            border: none;
        }


        button {
            cursor: pointer;
        }
    </style>
</head>
<body>
<article>
    <div class="inbody1">
        <div class="inbody1-1">
            <img src="/media/{{ user.business.image }}">
        </div>
        <div class="inbody1-2">
            <ul>
                <li>商家名称：{{ user.business }}</li>
                <li>商家位置：{{ user.business.get_position_display }} {{ user.business.get_floor_display }}</li>
            </ul>
        </div>

        <div class="inbody1-3">
            <button onclick="window.location.href='{% url 'changestatus' %}'" style="cursor: pointer">
                {% if user.business.is_open %}关闭{% else %}开启{% endif %}预约
            </button>
        </div>
    </div>
</article>
<article>
    <div class="order">
        <div class="order-info">
            <span>预约信息</span>
        </div>
        <div class="order-ing">

            <div class="order-dcl">
                <a class="order-a {% if not request.GET.s or request.GET.s == 'pending' %}aactive{% endif %}"
                   href="?s=pending">待处理</a>
            </div>

            <div class="order-jxz">
                <a class="order-a {% if request.GET.s == 'now' %}aactive{% endif %}" href="?s=now">进行中</a>
            </div>

            <div class="order-ywc">
                <a class="order-a {% if request.GET.s == 'done' %}aactive{% endif %}" href="?s=done">已完成</a>
            </div>
        </div>
        <div class="order-list">
            {% if not request.GET.s or request.GET.s == 'pending' %}
                {% get_pending_order_list user.business as pending_list %}
                {% for order in pending_list %}
                    <div class="order-list1">
                        <div class="order-list-z">
                            <p>{{ order.food.name }}</p>
                        </div>
                        <div class="order-list-y">
                            <button class="receive" type="button"
                                    onclick="window.location.href='{% url 'accept_or_deny' %}?op=accept&opk={{ order.pk }}'">
                                接受订单
                            </button>
                            <button class="object" type="button"
                                    onclick="window.location.href='{% url 'accept_or_deny' %}?op=deny&opk={{ order.pk }}'">
                                拒绝订单
                            </button>
                        </div>
                    </div>
                {% endfor %}
            {% elif request.GET.s == 'now' %}
                {% for order in user.get_businessuser_now_order %}
                    <div class="order-in">
                        <div class="orderin1">
                            <p>订单号：{{ order.pk }}</p>
                        </div>
                        <div class="orderin2">
                            <p> {{ order.food.name }}</p>
                        </div>
                        <div class="orderin3"></div>
                    </div>
                    <div class="order-on">
                        <div class="orderon1">
                            <p> {{ order.user.truename }}</p>
                        </div>
                        <div class="orderon2">
                            <p> {{ order.user.oauthqqprofile.get_sex_display }}</p>
                        </div>
                        <div class="orderon3">
                            <button type="button" onclick="complain(opk={{ order.pk }}, b=this)"
                                    style="cursor: pointer">未取餐
                            </button>
                        </div>
                    </div>
                {% endfor %}
            {% elif request.GET.s == 'done' %}
                {% get_done_order_list user.business as done_list %}
                {% for order in done_list %}
                    <div class="order-list1">
                        <div class="order-list-z">
                            <p>{{ order.food.name }}</p>
                        </div>
                        <div class="order-list-y">
                            完成时间：{{ order.date_done }}
                        </div>
                    </div>
                {% endfor %}
            {% endif %}
        </div>
    </div>
</article>

<article>
    <a href="{% url 'about' %}" class="business-a">
        <div class="business-li">
            <div class="t1">
                <img src="http://ouq4wie1o.bkt.clouddn.com/%E5%85%B3%E4%BA%8E%E6%88%91%E4%BB%AC.png" width="24px"
                     height="24px">
            </div>
            <div class="t2">
                <span>&nbsp;关于我们</span>
            </div>
            <div class="t3">
                <span>></span>
            </div>
        </div>
    </a>

    <a href="{% url 'agree' %}" class="business-a">
        <div class="business-li">
            <div class="t1">
                <img src="http://ouq4wie1o.bkt.clouddn.com/%E5%8D%8F%E8%AE%AE.png" width="24px" height="24px">
            </div>
            <div class="t2">
                <span>&nbsp;使用协议</span>
            </div>
            <div class="t3">
                <span>></span>
            </div>
        </div>
    </a>
</article>


<script>
    function complain(opk, b) {
        $.post("{% url 'complain' %}", {
                opk: opk,
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            function (data) {
                if (data['status'] === 1) {
                    alert("感谢您的投诉，我们已限制该用户的相关操作");
                    location.reload();
                } else if (data['status'] === 0) {
                    alert("出错啦");
                }
            },
            "json");
    }
</script>
</body>
</html>
